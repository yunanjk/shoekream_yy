<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOEKREAM | Welcome Draw</title>
    <link data-n-head="ssr" rel="icon" type="image/x-icon" href="https://kream.co.kr/favicon.ico">
 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

    <!-- Slick 불러오기 -->
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="../../js/main/slick.min.js"></script>
    <link rel="stylesheet" href="../../css/exhibit/events.css" />
    <link rel="stylesheet" href="../../css/exhibit/timesale.css" />
    <link rel="stylesheet" href="/css/fragment/footer.css">
    <script src="https://kit.fontawesome.com/c6de1e900d.js" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="__nuxt"><!---->
            <div id="__layout">
                <div tabindex="0" class="wrap win_os lg" ><!---->
                    <div>
                        <header th:replace="/fragment/header :: header"></header>
                    </div>
                            </div>
                        </div>
                    </div>
                     <input type="hidden" value="" id="isPoint">
                    <div class="container detail lg lucky_draw_column"  >
                        <div class="content" >
                            <h2 class="blind" >상품 상세</h2>
                            <div class="column_bind" >
                                <div class="column is_fixed">
                                    <div id="pro_slider-div" class="column_box" style="width: 560px; height: 560px;">
                                        <div class="main_banner" style="width: 100%; background-color:  gray;">
                                            <picture class="picture">
                                                <img alt="상품 이미지" src="" loading="lazy" fetchpriority="high" class="bannerImg eventProduct">
                                            </picture>
                                        </div>
                                    </div>
                                </div>
                                <div class="column" ><!---->
                                    <div class="product_lucky_draw_info column_box" 
                                        >
                                        <p class="product_event" >EVENT</p>
                                        <div class="detail_main_title lg"  >
                                            <div class="main_title_box" >
                                                <div ><!----><!----></div>
                                                <p class="title" id="eventName" > 12/24 LUCKY BOX(Random) </p>
                                                <p class="sub_title" id="eventNameKor">12월 24일 럭키박스</p>
                                            </div>
                                        </div>
                                        <div class="lucky_draw lg"  >
                                            <div class="draw_status" >
                                                <div id="timesale"></div>  
                                                <p class="description" >당첨자 발표</p>
                                            </div><button
                                                class="btn_luckydraw display_button xlarge dark_filled active block disabled"
                                                style="background-color:#222222;color:#FFFFFF;" id="btn_luckydraw"
                                                 > 당첨자 안내 </button>
                                                <input type="hidden" class="hidden_value">
<!--                                            <p class="draw_noti" >* 이벤트는 앱에서 진행됩니다</p>&lt;!&ndash;&ndash;&gt;-->
                                        </div><!---->
                                        <ul class="draw_list"  >
                                            <li class="draw_item" >
                                                <dl class="item_box" >
                                                    <dt class="title" > 응모 기간 </dt>
                                                    <dd class="detail startEndTime" > 2월 13일 월요일 오전 10:00 - 2월
                                                        14일 화요일 오전 12:00 </dd>
                                                </dl><!----><!---->
                                            </li>
                                            <li class="draw_item" >
                                                <dl class="item_box" >
                                                    <dt class="title" > 당첨자 발표 </dt>
                                                    <dd class="detail" id="endTime2"> 2월 14일 월요일 오후 6:00 </dd>
                                                </dl><!----><!---->
                                            </li>
                                            <li class="draw_item" >
                                                <dl class="item_box" >
                                                    <dt class="title" > 당첨 인원 </dt>
                                                    <dd class="detail" > 2명 </dd>
                                                </dl><!----><!---->
                                            </li>
                                        </ul>
                                        <div class="float_luckydraw_button" style="display:none;" >
                                            <button class="display_button medium dark_filled active block"
                                                style="background-color:#222222;color:#FFFFFF;" 
                                                > 당첨자 안내 </button></div>
                                    </div><!----><!---->
                                </div>
                            </div><!---->
                            <ul class="draw_list center_align"  >
                                <li class="draw_item" ><!----><!---->
                                    <dl class="item_box" >
                                        <dt class="title" >유의 사항</dt>
                                        <dd class="detail" >
                                            <ul class="note_list" >
                                                <li class="note_item" > 본 이벤트는 KREAM 신규회원 한정 드로우
                                                    이벤트입니다. (22년 12월 1일 이후 가입 회원 대상) </li>
                                                <li class="note_item" > 일자 별 드로우는 매일 오전 10시부터 오전 12시까지
                                                    응모 가능합니다. </li>
                                                <li class="note_item" > 당첨자에 한하여 매 응모 다음날 오후 6시에
                                                    1,000원이 체결됩니다. (금,토,일 응모제품: 월요일 18시 일괄 체결) </li>
                                                <li class="note_item" > 당첨자 1명 당 요일 별 경품 중 1개가 랜덤
                                                    발송됩니다. </li>
                                                <li class="note_item" > 매주 월요일 오후 6시에 주차별 당첨자 공지사항이
                                                    업로드됩니다. </li>
                                                <li class="note_item" > 금, 토, 일 당첨자에게는 차주 월요일 6시 개별
                                                    안내됩니다. </li>
                                                <li class="note_item" > 응모 시 등록한 결제정보로 결제가 진행되지 않으면
                                                    당첨이 즉시 취소되며, 후 순위 당첨자로 변경될 수 있습니다. </li>
                                                <li class="note_item" > 럭키박스의 상품과 사이즈는 랜덤으로 지급되며, 교환 및
                                                    환불이 불가합니다. </li>
                                                <li class="note_item" > 본 이벤트는 앱 전용 이벤트입니다. </li>
                                                <li class="note_item" > 본인 인증을 한 회원만 응모 가능합니다. </li>
                                                <li class="note_item" > 당첨자에 한하여 개별 메시지를 발송 드리며,
                                                    미당첨자에게는 별도의 연락을 드리지 않습니다. </li>
                                                <li class="note_item" > 제세공과금은 KREAM에서 부담하며, 제세공과금 처리를
                                                    위해 가입하신 이메일 주소로 신분증 등 서류를 요청드립니다. </li>
                                                <li class="note_item" > 당첨자에게 서류 요청 후, 72시간 내에 회신이 없으면
                                                    당첨이 자동 취소됩니다. </li>
                                                <li class="note_item" > 회원정보가 일치하지 않거나 부당한 방법으로 응모한
                                                    고객의 경우 응모 취소 및 추후 이벤트 응모 시 불이익을 받을 수 있습니다. </li>
                                                <li class="note_item" > 일부 제품은 출시 연기 및 수급 상황에 따라 배송이
                                                    늦어질 수 있습니다. </li>
                                                <li class="note_item" > 본 럭키박스 중 일부는 95점 상품으로 구성되어
                                                    있습니다. </li>
                                            </ul>
                                        </dd>
                                    </dl>
                                </li>
                            </ul><!---->
                        </div><!---->
                        <div >
                            <div   class="banner_bottom lg"><a 
                                    href="#" class="banner_box"><img 
                                        src="../../img/main/home_banner_bottom1.79549cb.png" loading="lazy" width="350"
                                        height="200" alt="SERVICE GUIDE" class="bg">
                                    <div  class="banner_info"><strong 
                                            class="info_subtitle">service guide</strong>
                                        <p  class="info_title">KREAM은 처음이지? <br>서비스 소개를 확인해보세요.</p>
                                        <span  class="info_txt">서비스 안내</span>
                                    </div>
                                </a><a  href="#" class="banner_box"><img 
                                        src="../../img/main/home_banner_bottom2.0077547.png" loading="lazy" width="350"
                                        height="200" alt="DOWNLOAD THE APP" class="bg">
                                    <div  class="banner_info"><strong 
                                            class="info_subtitle">download the app</strong>
                                        <p  class="info_title">KREAM 앱을 설치하여 <br>한정판 스니커즈를 FLEX 하세요!
                                        </p><span  class="info_txt">앱 설치하기</span>
                                    </div>
                                </a><!----></div>
                        </div><!----><!----><!----><!----><!----><!---->
                    </div>
        <footer th:replace="/fragment/footer :: footer"></footer>
                    <div ><!---->
                        <div id="toast" class="toast lg" >
                            <div class="wrap" ><svg xmlns="http://www.w3.org/2000/svg"
                                    class="icon sprite-icons toast-icon toast-success" >
                                    <use href="/_nuxt/3182c3b1ca2f77da7bc3e1acf109306c.svg#i-toast-success"
                                        xlink:href="/_nuxt/3182c3b1ca2f77da7bc3e1acf109306c.svg#i-toast-success"
                                        ></use>
                                </svg>
                                <div class="toast-content" >
                                    <p >내용</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </body>


<script>
    const btnLucky = document.querySelector('#btn_luckydraw');

    const event = document.querySelector('.hidden_value').value;
    fetch('http://localhost:8889/api/admin/event/' + event)
        .then((response) => response.json())
        .then((data) => {
            let startTime = data.startTime;
            let endTime  = data.endTime;
            let countDownDate = new Date(endTime).getTime();
            let countNewDate = new Date(startTime).getTime(); // 이벤트 시작시간
            let x = setInterval(function() {
                let now = new Date().getTime(); // 현재시간
                let distance1 = countNewDate - now // 시작시간 - 현재시간  >>> 0보다크면 준비중
                let distance = countDownDate - now; //종료시간 - 현재시간
                // 이벤트 마감시 보여질 문구
                if(distance1>0){
                    setTimesale(1,"준비중.");
                    setBtn("진행 예정");
                }
                else if (distance < 0) {
                    clearInterval(x);
                    setTimesale(1,"CLOSED.");
                    setBtn("당첨자 안내");
                    document.getElementById("btn_luckydraw").addEventListener('click',()=>location.href="/notice")
                    btnLucky.classList.remove('disabled');
                }
                else{
                    setTimesale(2,distance);
                    setBtn("응모 하기");
                    btnLucky.classList.remove('disabled');
                    document.getElementById("btn_luckydraw").addEventListener('click',sendit)
                }
            }, 1000);
            // cd: 1 param 표기, 2 현재시간 비교
            function setTimesale(cd, param){

                if(cd == 1){
                    document.getElementById("timesale").innerHTML = "<div class='endtxt'>"+param+"</div>";

                }else if (cd == 2){

                    let days = Math.floor(param / (1000 * 60 * 60 * 24));
                    let hours = Math.floor((param % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    let minutes = Math.floor((param % (1000 * 60 * 60)) / (1000 * 60));
                    let seconds = Math.floor((param % (1000 * 60)) / 1000);


                    if ( hours < 10 ){hours = "0" + hours; }
                    else if ( hours > 9 ){ hours = hours; }

                    if ( minutes < 10 ){minutes = "0" + minutes; }
                    else if ( minutes > 9 ){ minutes = minutes; }

                    if ( seconds < 10 ){seconds = "0" + seconds; }
                    else if ( seconds > 9 ){ seconds = seconds; }

                    // 타임이벤트 진행 타이머
                    document.getElementById("timesale").innerHTML = days + "<span class='time_span'>일</span> " + hours + "<span class='time_span'>시간</span> "
                        + minutes + "<span class='time_span'>분</span> " + seconds + "<span class='time_span'>초</span>";
                }
            }
            function setBtn(param){
                document.getElementById("btn_luckydraw").innerHTML = param;
            }
        })
    function sendit() {
        // create
        //request로 필요한 DOM 객체 선택
        const event = document.querySelector('.hidden_value');

        fetch('http://localhost:8889/api/admin/event/draw', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                //우리가 만든데이터
                "transaction_time":`${new Date()}`,
                "resultCode":"ok",
                "description":"정상",
                "data":{
                    "eventProductIdx":`${event.value}`,
                }
            }),
        })
            .then((res) => {
                console.log(res)
                if(document.querySelector("#isPoint").getAttribute('value')==='true'){
                    alert("이벤트 참여완료")
                    location.reload()
                }else{
                    alert("포인트 부족")
                    location.reload()
                }

                console.log(res.redirected)
                return; //리턴을 걸어서 진행하는 것을 막는다!
            })
            .then((data) => {
                // alert('등록성공')
                // location.reload();
                console.log(data);
                return;
            })
            .catch((err)=>{
                alert(err);
            })
    }
    // const btnLucky = document.querySelector('#btn_luckydraw');
    // function setTimesale(cd, param){
    //     if(cd == 1){
    //         document.getElementById("timesale").innerHTML = "<div class='endtxt'>"+param+"</div>";
    //     }else if(cd == 2){
    //
    //         var days = Math.floor(param / (1000 * 60 * 60 * 24));
    //         var hours = Math.floor((param % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    //         var minutes = Math.floor((param % (1000 * 60 * 60)) / (1000 * 60));
    //         var seconds = Math.floor((param % (1000 * 60)) / 1000);
    //
    //
    //         if ( hours < 10 ){hours = "0" + hours; }
    //         else if ( hours > 9 ){ hours = hours; }
    //
    //         if ( minutes < 10 ){minutes = "0" + minutes; }
    //         else if ( minutes > 9 ){ minutes = minutes; }
    //
    //         if ( seconds < 10 ){seconds = "0" + seconds; }
    //         else if ( seconds > 9 ){ seconds = seconds; }
    //
    //         // 타임이벤트 진행 타이머
    //         document.getElementById("timesale").innerHTML = days + "<span class='time_span'>일</span> " + hours + "<span class='time_span'>시간</span> "
    //             + minutes + "<span class='time_span'>분</span> " + seconds + "<span class='time_span'>초</span>";
    //     }
    // }
    // fetch('http://localhost:8889/api/admin/event/' + 1)
    //     .then((response) => response.json())
    //     .then((data) => {
    //         var startTime = data.startTime;
    //         var endTime  = data.endTime;
    //         var countDownDate = new Date(endTime).getTime();
    //         var countNewDate = new Date(startTime).getTime(); // 이벤트 시작시간
    //         var x = setInterval(function() {
    //             var now = new Date().getTime(); // 현재시간
    //             var distance1 = countNewDate - now // 시작시간 - 현재시간  >>> 0보다크면 준비중
    //             var distance = countDownDate - now; //종료시간 - 현재시간
    //             // 이벤트 마감시 보여질 문구
    //             if(distance1>0){
    //                 setTimesale(1,"준비중.");
    //                 setBtn("진행 예정");
    //             }
    //             else if (distance < 0) {
    //                 clearInterval(x);
    //                 setTimesale(1,"CLOSED.");
    //                 setBtn("당첨자 안내");
    //                 document.getElementById("btn_luckydraw").addEventListener('click',()=>location.href="/notice")
    //                 btnLucky.classList.remove('disabled');
    //             }
    //             else{
    //                 setTimesale(2,distance);
    //                 setBtn("응모 하기");
    //                 btnLucky.classList.remove('disabled');
    //                 document.getElementById("btn_luckydraw").addEventListener('click',sendit)
    //             }
    //         }, 1000);
    //         // cd: 1 param 표기, 2 현재시간 비교
    //
    //         function setTimesale(cd, param){
    //
    //             if(cd == 1){
    //                 document.getElementById("timesale").innerHTML = "<div class='endtxt'>"+param+"</div>";
    //
    //             }else if (cd == 2){
    //
    //         function setBtn(param){
    //                 document.getElementById("btn_luckydraw").innerHTML = param;
    //         }
    //     })
    // function sendit() {
    //     // create
    //     //request로 필요한 DOM 객체 선택
    //     const event = document.querySelector('.hidden_value');
    //
    //     fetch('http://localhost:8889/api/admin/event/draw', {
    //         method: 'POST',
    //         headers: { 'Content-Type': 'application/json' },
    //         body: JSON.stringify({
    //             //우리가 만든데이터
    //             "transaction_time":`${new Date()}`,
    //             "resultCode":"ok",
    //             "description":"정상",
    //             "data":{
    //                 "eventProductIdx":`${event.value}`,
    //             }
    //         }),
    //     })
    //         .then((res) => {
    //             console.log(res)
    //             console.log(res.redirected)
    //             return; //리턴을 걸어서 진행하는 것을 막는다!
    //         })
    //         .then((data) => {
    //             // alert('등록성공')
    //             // location.reload();
    //             console.log(data);
    //             return;
    //         })
    //         .catch((err)=>{
    //             alert(err);
    //         })
    // }

    // var countDownDate = new Date("January 24, 2023 11:48:00").getTime();
    // var countNewDate = new Date("January 24, 2023 12:15:00").getTime(); // 이벤트 시작시간
    // var x = setInterval(function() {
    //
    //     var now = new Date().getTime(); // 현재시간
    //
    //     var distance1 = countNewDate - now // 시작시간 - 현재시간  >>> 0보다크면 준비중
    //     var distance = countDownDate - now; //종료시간 - 현재시간
    //
    //     // 이벤트 마감시 보여질 문구
    //     if(distance1>0){
    //         setTimesale(1,"준비중.");
    //     }
    //     else if (distance < 0) {
    //         clearInterval(x);
    //         setTimesale(1,"CLOSED.");
    //     }
    //     else{
    //         setTimesale(2,distance);
    //     }
    // }, 1000);
    //
    //
    // // cd: 1 param 표기, 2 현재시간 비교
    // function setTimesale(cd, param){
    //
    //     if(cd = 1){
    //         document.getElementById("timesale").innerHTML = "<div class='endtxt'>"+param+"</div>";
    //
    //     }else if (cd = 2){
    //
    //         var days = Math.floor(param / (1000 * 60 * 60 * 24));
    //         var hours = Math.floor((param % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    //         var minutes = Math.floor((param % (1000 * 60 * 60)) / (1000 * 60));
    //         var seconds = Math.floor((param % (1000 * 60)) / 1000);
    //
    //
    //         if ( hours < 10 ){hours = "0" + hours; }
    //         else if ( hours > 9 ){ hours = hours; }
    //
    //         if ( minutes < 10 ){minutes = "0" + minutes; }
    //         else if ( minutes > 9 ){ minutes = minutes; }
    //
    //         if ( seconds < 10 ){seconds = "0" + seconds; }
    //         else if ( seconds > 9 ){ seconds = seconds; }
    //
    //         // 타임이벤트 진행 타이머
    //         document.getElementById("timesale").innerHTML = days + "<span class='time_span'>일</span> " + hours + "<span class='time_span'>시간</span> "
    //             + minutes + "<span class='time_span'>분</span> " + seconds + "<span class='time_span'>초</span>";
    //     }
    // }
</script>

</html>