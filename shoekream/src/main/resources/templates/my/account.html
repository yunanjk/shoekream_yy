<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOEKREAM | 한정판 거래의 FLEX</title>
    <link rel="stylesheet" href="/css/my/account.css">
    <link rel="stylesheet" href="/css/fragment/mypage_navbar.css">
    <link rel="stylesheet" href="/css/fragment/footer.css">
    <link data-n-head="ssr" rel="icon" type="image/x-icon" href="https://kream.co.kr/favicon.ico">
    <script defer src="/js/fragment/mypage_navbar.js"></script>
</head>

<body>
<!--header-->
<header th:replace="/fragment/header::header"></header>
<!--header-->
<div class="container my lg" style="margin-top: 100px;">
    <div>
        <!-- navbar -->
        <nav th:replace="/fragment/mypage_navbar::nav"></nav>
        <!--navbar-->
    </div>
    <div class="content_area">
        <div class="my_account">
            <div class="content_title">
                <div class="title">
                    <h3>정산 계좌 변경</h3>
                    <!---->
                </div>
                <!---->
            </div>
            <div class="registered_account_box">
                <h4 class="box_title">등록된 계좌 정보</h4>
                <p class="box_account_info"><span class="account" id="bank_name">은행명</span>
                    <span class="account" id="acc_number">계좌번호</span><span class="account_devider">/</span><span
                            class="name" id="name"></span></p>
            </div>
            <div class="content_registration">
                <div class="account_registration">
                    <div class="input_logistics_companies input_box">
                        <h4 class="input_title">은행명</h4>
                        <div onclick="dropdown()" class="input_item"><input id="input_bank" type="text"
                                                                            placeholder="선택하세요" readonly="readonly" autocomplete="off" inputmode="numeric"
                                                                            class="input_txt"><button  type="button" class="btn btn_dropdown"
                        ><img src="/img/down.png" alt="img"></button>
                        </div>
                        <div class="bank_dropdown_menu" style="display: none;">
                            <ul class="bank_list">
                                <li class="bank_list_li">국민은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">신한은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">우리은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">하나은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">기업은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">농협은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">SC은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">우체국<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">한국씨티은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">산업은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">카카오뱅크<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">부산은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">대구은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">광주은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">케이뱅크<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">수협중앙회<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">제주은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">전북은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">지역농축협<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">경남은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">새마을금고연합회<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">신협<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">저축은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">HSBC은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">도이치은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">제이피모간체이스은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">BOA은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">비엔피파리바은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">중국공상은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">산림조합<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">중국건설은행<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                                <li class="bank_list_li">토스뱅크<img class="check_image" src="/img/wcheck.png" alt="img" style="display:none"></li>
                            </ul>
                        </div>
                    </div>
                    <div class="input_box" id="input_acc_box">
                        <h4 class="input_title">계좌번호</h4>
                        <div class="input_item"><input id="input_acc" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" type="text"
                                                       placeholder="- 없이 입력하세요" autocomplete="off" class="input_txt input_write"></div>
                        <p class="input_error">올바른 계좌번호를 입력해주세요.</p>
                    </div>
                    <div class="input_box" id="input_holder_box">
                        <h4 class="input_title">예금주</h4>
                        <div class="input_item"><input disabled="disabled" id="input_holder" type="text"
                                                       placeholder="예금주명을 정확히 입력하세요." autocomplete="off" class="input_txt input_write"></div>
                        <p class="input_error">올바른 이름을 입력해주세요. (2-50자)</p>
                    </div>
                </div>
                <div class="registration_btn_box"><a id="submit_btn"
                                                     disabled="disabled" href="javascript:void(0);" class="btn btn_save solid medium disabled"> 변경하기 </a></div>
                <!---->
            </div>
        </div>
    </div>
</div>
<footer th:replace="/fragment/footer::footer"></footer>
<div><div style="display: none;" class="layer lg layer_alert"><div class="layer_container"><a href="#" class="btn_layer_close"></a><div class="layer_header"></div><div class="layer_content"><div class="alert_box high"><p class="alert_desc">이미 진행 중인 거래를 포함하여 앞으로
    모든 거래의 대금 정산이 해당 계좌로 변경됩니다.</p></div><div class="layer_btn"><button type="button" class="btn outlinegrey medium"> 취소 </button><button type="button" class="btn solid
                 medium"> 확인 </button></div></div></div></div><div  id="toast" class="toast lg"><div  class="wrap"><div  class="toast-content"></div></div></div></div>
<script>

    function dropdown(){
        // 클릭했을때 style.display==="none" => block 아니면 none
        const bankId = document.querySelector(".bank_dropdown_menu")
        if(bankId.style.display == "none"){
            bankId.style.display = "block"
        }else{
            bankId.style.display = "none"
        }
    }
    /*
    const selectable = document.querySelectorAll(".button_shipping_memo_wrap.selectable");
    selectable.forEach((item)=>{
        item.addEventListener('click',()=>{
            selectable.forEach((e)=>{
                e.classList.remove('checked');
                e.childNodes[2].style.display="none";
            })
            //직접입력부분도 효과 없애준다.
            direct_input.classList.remove('checked')
            document.querySelector(".direct_input img").style.display="none"
            document.querySelector(".textarea_shipping_memo").style.display="none"
            //클릭한 애만 효과준다.
            item.classList.add('checked');
            console.log(item.childNodes)
            item.childNodes[2].style.display="block";
            //직접입력 갔다가 돌아왔을때 방지용
            memo_apply_btn.classList.remove('disabled')

        })
    })
    */

    const bankId = document.querySelector(".bank_dropdown_menu")
    const bankList = document.querySelectorAll('.bank_list_li')
    const bankName = document.querySelector(".input_txt")
    bankList.forEach((target) => {
        target.addEventListener("click", function(){
            bankName.placeholder = event.target.textContent
            bankList.forEach((e) => {
                e.classList.remove("select_bank")
                e.childNodes[1].style.display="none"
            })

            bankName.classList.add("input_txt_color")
            target.classList.add("select_bank")
            target.childNodes[1].style.display = "block"
            bankId.style.display = "none"
            // if(bankNameForm.placeholder != '선택하세요'){
            // switch(!(accountHolder.value && accountForm.value)){
            //     case true : submitButton.disabled = true; submitButton.classList.add('disabled'); break;
            //     case false : submitButton.disabled = false; submitButton.classList.remove('disabled'); break;
            //     }
            // }

            //     if(bankNameForm.placeholder != '선택하세요' && validateName(strName) && validateAcc(strAcc)){
            // submitButton.classList.remove('disabled')
            //     }else{
            //         submitButton.classList.add('disabled')
            //     }
        })})
    // 버튼활성화
    const bankNameForm = document.querySelector('#input_bank')
    const accountForm = document.querySelector('#input_acc')
    const accountHolder = document.querySelector('#input_holder')
    const submitButton = document.querySelector('#submit_btn')
    bankNameForm.addEventListener('keyup', activeEvent);
    accountForm.addEventListener('keyup', activeEvent);
    accountHolder.addEventListener('keyup', activeEvent);
    let strName
    let strAcc
    function activeEvent() {
        switch(accountHolder.value && accountHolder.value && bankNameForm.placeholder != '선택하세요' && validateName(strName) && validateAcc(strAcc)){
            case true : submitButton.disabled = true; submitButton.classList.remove('disabled'); submitButton.addEventListener('click',submit_account); break;
            case false : submitButton.disabled = false; submitButton.classList.add('disabled'); submitButton.removeEventListener('click',submit_account); break;
        }
    }
    // 버튼 submit
    function submit_account() {
        if (!submitButton.classList.contains('disabled')) {
            let bankName = document.querySelector('#input_bank').placeholder
            let accNum = document.querySelector('#input_acc').value
            fetch('http://localhost:8889/api/my/account', {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    "transaction_time": `${new Date()}`,
                    "resultCode": "ok",
                    "description": "정상",
                    "data": {
                        "bank": `${bankName}`,
                        "accNumber": `${accNum}`
                    }
                }),
            }).then((res) => {
                alert('계좌변경 완료');
                location.href = '/my/account';
                return;
            })
        }
    }

    // 계좌번호 정규 표현식
    function validateAcc(strAcc){
        const reg_acc = /^[0-9]{2,}$/;
        if(!reg_acc.test(''+strAcc)){
            return false;
        }
        return true;
    }
    // 이름 정규 표현식
    function validateName(strName){
        const reg_name =  /^[가-힣a-zA-Z]{2,50}$/;
        // const reg_name = /^[가-힣]{2,50}$/;
        if(!reg_name.test(''+strName)){
            return false;
        }
        return true;
    }
    // 이름 유효성 검사
    document.querySelector('#input_holder').addEventListener('input', e=>{
        strName=e.target.value;
        let errorMsg='';
        if(!validateName(strName)){
            errorMsg='이름을 정확히 입력해주세요.';
            document.querySelector('#input_holder_box').className='has_button input_box has_error';
            document.querySelector('#input_holder').setAttribute('validateresult',false);

        } else {
            document.querySelector('#input_holder_box').className='has_button input_box fill';
            document.querySelector('#input_holder').setAttribute('validateresult',true);
        }
    });
    // 계좌번호 유효성 검사
    document.querySelector('#input_acc').addEventListener('input', e => {
        strAcc = e.target.value;
        if(!validateAcc(strAcc)){
            document.querySelector('#input_acc_box').className='has_button input_box has_error';
            document.querySelector('#input_acc').setAttribute('validateresult',false);
        } else {
            document.querySelector('#input_acc_box').className='has_button input_box fill';
            document.querySelector('#input_acc').setAttribute('validateresult',true);

        }

    })
</script>
</body>

</html>