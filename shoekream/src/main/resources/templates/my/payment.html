<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOEKREAM | 한정판 거래의 FLEX</title>
    <link rel="stylesheet" href="/css/my/payment.css">
    <link rel="stylesheet" href="/css/fragment/mypage_navbar.css">
    <link rel="stylesheet" href="/css/layer/layer.css">
    <link rel="stylesheet" href="/css/layer/layer_card.css">
    <link rel="stylesheet" href="/css/fragment/footer.css">
    <link data-n-head="ssr" rel="icon" type="image/x-icon" href="https://kream.co.kr/favicon.ico">
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
            integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script defer src="/js/fragment/mypage_navbar.js"></script>
</head>

<body>
<header th:replace="/fragment/header::header"></header>
<div class="container my lg" style="margin-top: 100px;">
    <div>
        <!-- navbar -->
        <nav th:replace="/fragment/mypage_navbar::nav"></nav>
        <!-- navbar -->
    </div>
    <div class="content_area">
        <div class="my_payment">
            <!---->
            <div class="content_title border has_sub">
                <div class="title">
                    <h3>결제 정보</h3>
                    <p class="sub_title">수수료(페널티, 착불배송비 등)가 정산되지 않을 경우, 별도 고지 없이 해당 금액을 결제 시도할 수
                        있습니다.</p>
                </div>
                <div class="btn_box"><a href="#" class="btn btn_add">
                    <!----><span class="btn_txt">+ 새 카드 추가하기</span>
                </a></div>
            </div>
            <!---->



            <div class="my_list">
                <div class="basic">
                    <div class="my_item" default-mark="기본 결제">
                        <div class="info_bind"><!---->
                            <div class="card_info"><span class="card_name"> BC</span>
                                <div class="card_num">
                                    <span class="num_bind">
                                    ●●●●-●●●●-●●●●-1234
                                    </span>
                                    <span class="mark">기본 결제</span>
                                </div>
                            </div>
                        </div>
                        <div class="btn_bind"><!----><!---->
                            <a  id="deleteCard" href="#" class="btn outlinegrey small"> 삭제 </a>
                        </div>
                    </div>
                </div>
                <div class="other">
                    <div class="my_item">
                        <div class="info_bind"><!---->
                            <div class="card_info">
                                <span class="card_name"> BC</span>
                                <div class="card_num"><span class="num_bind">
                                    ●●●●-●●●●-●●●●-5678
                                </span><!---->
                                </div>
                            </div>
                        </div>
                        <div class="btn_bind">
                            <a id="basicCard2" href="#" class="btn outlinegrey small"> 기본 결제 </a><!---->
                            <a id="deleteCard2" href="#" class="btn outlinegrey small"> 삭제 </a>
                        </div>
                    </div>
                </div>
            </div>



            <div>
                <div class="empty_area has_bg" style="display: none">
                    <p class="desc">추가하신 결제 정보가 없습니다.</p>
                    <!---->
                </div>
            </div>
        </div>
        <div class="layer_alert layer lg" style="display: none;">
            <div class="layer_container"><a href="#" class="btn_layer_close"></a>
                <div class="layer_header">
                    <h2 class="title">삭제하시겠습니까?</h2>
                </div>
                <div class="layer_content">
                    <div class="layer_btn">
                        <button type="button" class="btn outline medium"> 취소</button>
                        <button
                                type="button" class="btn solid medium"> 계속 변경
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!---->
    </div>
</div>
<div class="layer_card layer lg" style="display: none;">
    <div class="layer_container"><a href="#" class="btn_layer_close">
        <div><img src="/img/close.png" onclick="closeLayer()"></div>
        <!---->
    </a>
        <div class="layer_header">
            <h2 class="title"> 새 카드 추가 </h2>
        </div>
        <div class="layer_content">
            <div class="card_bind">
                <div class="card_input">
                    <div class="input_box" id="card_input_box">
                        <h4 class="input_title">카드번호</h4>
                        <div class="input_item" id="connected-input">
                            <input type="number" maxlength="4" placeholder="⦁⦁⦁⦁" autocomplete="off"
                                   class="input_card" id="cc-1" oninput="maxLengthCheck(this)"> -
                            <input type="number" maxlength="4" placeholder="⦁⦁⦁⦁" autocomplete="off"
                                   class="input_card" id="cc-2" oninput="maxLengthCheck(this)"> -
                            <input type="number" maxlength="4" placeholder="⦁⦁⦁⦁" autocomplete="off"
                                   class="input_card" id="cc-3" oninput="maxLengthCheck(this)"> -
                            <input type="number" maxlength="4" placeholder="⦁⦁⦁⦁" autocomplete="off"
                                   class="input_card" id="cc-4" oninput="maxLengthCheck(this)">
                        </div>
                        <p class="input_error" id="card_input_error"></p>
                    </div>
                    <div class="input_box" id="expirydate_input_box">
                        <h4 class="input_title">유효기간</h4>
                        <div class="input_item">
                            <!-- <input type="tel" placeholder="12" autocomplete="off" class="input_expirydate"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="tel" placeholder="2025" autocomplete="off" class="input_expirydate" id="expirydate_input"> -->
                            <select class="input_expiration_month" id="expiration-month"
                                    aria-label="Expiration Month" required>
                                <option>01</option>
                                <option>02</option>
                                <option>03</option>
                                <option>04</option>
                                <option>05</option>
                                <option>06</option>
                                <option>07</option>
                                <option>08</option>
                                <option>09</option>
                                <option>10</option>
                                <option>11</option>
                                <option>12</option>
                            </select>
                            <select class="input_expiration_year" id="expiration-year" aria-label="Expiration Year"
                                    required>
                                <option>2023</option>
                                <option>2024</option>
                                <option>2025</option>
                                <option>2026</option>
                                <option>2027</option>
                                <option>2028</option>
                            </select>
                        </div>
                        <p class="input_error"></p>
                    </div>
                    <div class="input_box" id="birthday_input_box">
                        <h4 class="input_title">생년월일</h4>
                        <div class="input_item">
                            <input type="number" maxlength="6" placeholder="⦁⦁⦁⦁⦁⦁" autocomplete="off"
                                   class="input_birthday" id="birthday_input" oninput="maxLengthCheck(this)">
                        </div>
                        <p class="input_error" id="birthday_input_error"></p>
                    </div>
                    <div class="input_box" id="pin_input_box">
                        <h4 class="input_title">비밀번호</h4>
                        <div class="input_item">
                            <input type="number" maxlength="2" placeholder="⦁⦁" autocomplete="off"
                                   class="input_cardpw" id="pin_input" oninput="maxLengthCheck(this)">**
                        </div>
                        <p class="input_error" id="pin_input_error"></p>
                    </div>
                </div>

            </div>
            <div class="layer_btn">
                <a href="#" class="btn btn_delete outlinegrey medium" onclick="closeLayer()"> 취소 </a>
                <a disabled="disabled" onclick="createCard()" href="#" class="btn btn_save solid medium disabled"
                   id="submit_btn"> 저장하기
                </a>
            </div>
        </div>
    </div>
</div>
<footer th:replace="/fragment/footer::footer"></footer>
<script src="/js/layer/layer_card.js"></script>
<script>


    const layerPayment = document.querySelector('.layer_card')

    const addBtn = document.querySelector('.btn_box')
    addBtn.addEventListener('click', (e) => {
        layerPayment.style.display = "block"
    })
    layerPayment.addEventListener('click', (e) => {
        if (e.target == e.currentTarget) {
            layerPayment.style.display = "none"
        }

    })

    // 레이어 닫는 부분
    function closeLayer() {
        document.querySelector('.layer_card').style.display = "none";
    }

    // 카드추가 확인 버튼
    function createCard() {
        btnSave = document.querySelector('#submit_btn')
        if (btnSave.classList.contains('disabled')) {

        } else {
            let cardNumber = document.querySelector('#cc-1').value +
                document.querySelector('#cc-2').value +
                document.querySelector('#cc-3').value +
                document.querySelector('#cc-4').value
            console.log(cardNumber)
            let dateMm = document.querySelector('#expiration-month').value;
            let dateYy = document.querySelector('#expiration-year').value;
            let birthday = document.querySelector('#birthday_input').value;
            let pin = document.querySelector('#pin_input').value;
            console.log(cardNumber, dateMm, dateYy, birthday, pin)
            fetch('http://localhost:8889/api/my/payment', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    "transaction_time": `${new Date()}`,
                    "resultCode": "ok",
                    "description": "정상",
                    "data": {
                        "cardNumber": `${cardNumber}`,
                        "cardMm": `${dateMm}`,
                        "cardYy": `${dateYy}`,
                        "birthDate": `${birthday}`,
                        "cardPw": `${pin}`
                    }
                }),
            }).then((res) => {
                alert('카드추가 완료');
                location.href = '/my/payment';
                return;
            })
        }
    }
    // 기본 카드 수정
    function basicCard(idx){
        fetch('http://localhost:8889/api/my/payment/'+idx,
            {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
            }).then((res)=>{
            alert('기본배송지 수정 완료');
            location.href='/my/payment';
            return;
        })
            .catch((err) => {
                alert(err);
            })
    }
    // 카드 삭제
    function deleteCard(idx){
        fetch('http://localhost:8889/api/my/payment/'+idx,
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
            }).then((res)=>{
            alert('배송지 삭제 완료');
            location.href='/my/payment';
            return;
        })
            .catch((err) => {
                alert(err);
            })
    }
</script>
</body>

</html>